1. 如何用mmap实现共享内存？
答：
- 多个进程通过 mmap 将共享内存映射到各自地址空间，读写同一物理内存实现通信。
- 创建共享内存 → 设置大小 → mmap 映射 → 数据读写 → 释放资源。

2. 一致性哈希是什么？
答：一致性哈希是一种特殊的**哈希算法**，主要用于 **分布式系统** 中，将数据均匀地分布到多台服务器或节点上，并在节点数量 **动态变化**（如新增或移除节点）时，尽可能 **减少数据迁移**，提升扩展性和负载均衡效果。

3. core dump怎么定位？
答：
- 分析 core dump 文件
    使用 gdb 加载 core dump 文件，重点使用以下命令：
    (gdb) bt：查看栈回溯，定位崩溃函数、调用链。
    (gdb) info locals：查看局部变量，定位异常数据。
    (gdb) info registers：检查 CPU 寄存器状态。


4. 如何定位一个进程CPU负载率高的原因？
答：
- 确认 CPU 占用情况：使用 `top`、`htop`、`vmstat` 定位占用高的 进程 和 线程。
- 分析 CPU 热点：使用 `perf top`、`perf record` 找出 高消耗函数。
- 系统调用分析：用 `strace` 检查 频繁的系统调用 和 锁竞争。
- 线程栈分析：使用 `pstack` 查看线程状态，查找死循环、死锁等异常。
- 上下文切换：用 `pidstat` 查看 自愿/非自愿切换，分析多线程竞争。


5. fork的实现原理？
答：
**基本概念**：fork() 是一个 系统调用，用于 创建子进程，父子进程共享资源，返回值不同。
实现流程：
   - 创建新的 task_struct
   - 写时复制 (COW) 优化内存
   - 调度器 决定父子进程执行顺序
关键技术：copy-on-write、do_fork()、clone()。
性能优化：使用 vfork()、clone()，减少内存复制和上下文切换。



6. 如何实现一个高性能的网络服务器？
答：
- 首先，我会选择 **事件驱动模型**，通过使用 I/O 多路复用（如 epoll）来处理大量并发连接，避免阻塞。
- 使用 **异步 I/O** 和回调机制来提高响应速度，避免阻塞操作。
- 采用 **连接池** 和 **线程池** 来高效管理资源，避免频繁创建和销毁连接。
- 为了减少数据库或磁盘的 I/O，使用 **内存缓存**（如 Redis）来加速热点数据的访问。
- 采用 **负载均衡** 来分担请求压力，确保系统的高可用性和可扩展性。
最后，通过优化操作系统和内存管理，确保服务器的高效运行。



7. 如何设计一个分布式系统？
答：
- 我首先会根据需求选择 **微服务架构**，将系统拆解成多个独立的服务，使用 `RESTful API` 或 `gRPC` 进行通信。每个服务尽量是 无状态的，避免数据存储在服务中，提升可扩展性。
- 在数据存储方面，选择使用 **分布式数据库**（如 Cassandra）和 **分布式缓存**（如 Redis Cluster），并根据 CAP 定理 和业务需求权衡一致性和可用性。
- 我会采用 **服务发现**（如 Consul）和 **负载均衡**（如 Nginx）来确保服务的高可用性，并用 **消息队列**（如 Kafka）处理异步任务，解耦服务之间的依赖。
- 为了实现高可用性和容错性，我会设计 **数据复制与备份**，使用 **熔断器** 和 **限流机制**（如 Hystrix）来保护系统免受故障影响。
- 最后，我会实现 **监控与日志**（如 Prometheus + Grafana），并采取 安全措施，如 OAuth2 和 TLS 加密，确保系统的安全性和数据保护。